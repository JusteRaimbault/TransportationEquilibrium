setwd(paste0(Sys.getenv('CS_HOME'),'/TransportationEquilibrium/Models/Visu'))
setwd(paste0(Sys.getenv('CS_HOME'),'/TransportationEquilibrium/Models/Visu'))
Sys.getenv('CS_HOME')
Sys.getenv('CS_HOME')
#setwd(paste0(Sys.getenv('CS_HOME'),'/TransportationEquilibrium/Models/Visu'))
setwd('/home/raimbault/ComplexSystems/TransportationEquilibrium/Models/Visu')
source('functions.R')
install.packages("RSQlite")
install.packages("RSQLite")
source('functions.R')
install.packages("rgdal")
install.packages("rgdal")
source('functions.R')
install.packages("igraph")
source('functions.R')
install.packages("spdep")
source('functions.R')
#db = dbConnect(SQLite(),"../../Data/Sytadin/data/sytadin_20160703.sqlite3")
db = dbConnect(SQLite(),"../../Data/Data/traffic_20160201-20160301.sqlite3")
data = dbGetQuery(db,'SELECT * FROM data;') #WHERE ts > 1466545462;')
source('prepareData.R')
data
sdata = data %>% group_by(ts)%>%summarise(avgtime=mean((tps-tps_th)/(1+tps_th)))
g=ggplot(sdata,aes(x=avgtime))
library(ggplot2)
g=ggplot(sdata,aes(x=avgtime))
g+geom_density()
min(ts)
sdata = data[data$ts<min(data$ts)+86400*7] %>% group_by(ts)%>%summarise(avgtime=mean((tps-tps_th)/(1+tps_th)))
sdata = data[data$ts<min(data$ts)+86400*7,] %>% group_by(ts)%>%summarise(avgtime=mean((tps-tps_th)/(1+tps_th)))
g=ggplot(sdata,aes(x=ts,y=avgtime))
g+geom_line()
congdata<-data %>% mutate(mintps=rep(mintps$mintps,nrow(data)/148))%>%mutate(congestion=1 - (mintps / (tps+1)))%>%group_by(ts)%>%summarise(
mcong=mean(congestion),mincong=mean(congestion)-sd(congestion),maxcong=mean(congestion)+sd(congestion)
)
g=ggplot(congdata[congdata$ts<min(congdata$ts)+86400*7,])
g=ggplot(congdata[congdata$ts<min(congdata$ts)+86400*7,],aes(x=ts,y=mcong))
g+geom_line()
g=ggplot(congdata[congdata$ts<min(congdata$ts)+86400*14,],aes(x=ts,y=mcong))
g+geom_line()
g+geom_line()+
geom_vline(xintercept=(seq(from=1454371200,to=1455467281,by=86400)-1454352603)/3600,color='red',linetype=2)
dtimes
times
g+geom_line()+
geom_vline(xintercept=(seq(from=1454371200,to=1455467281,by=86400)-1454352603),color='red',linetype=2)
g+geom_line()+
geom_vline(xintercept=(seq(from=1454371200,to=1455467281,by=86400)),color='red',linetype=2)
g+geom_line()+
geom_vline(xintercept=(seq(from=1454371200,to=1455467281,by=86400)),color='red',linetype=2)+xlab("time")+ylab("congestion")
1455467281+_-'àà'
1455467281+86400
g+geom_line()+
geom_vline(xintercept=(seq(from=1454371200,to=1455553681,by=86400)),color='red',linetype=2)+xlab("time")+ylab("congestion")
g+geom_line()+
geom_vline(xintercept=(seq(from=1454371200,to=1455553681,by=86400)),color='red',linetype=2)+xlab("time")+ylab("congestion")
ggsave(file = '../../Results/Stats/congestion.png',width='30',height='20',units='cm')
ggsave(file = '../../Results/Stats/congestion.png',width='30',height='20',units='cm')
ggsave(file = '../../Results/Stats/congestion.png',width='30',height='20',units=cm)
ggsave(file = '../../Results/Stats/congestion.png',width='30',height='20')
ggsave(file = '../../Results/Stats/congestion.png')
